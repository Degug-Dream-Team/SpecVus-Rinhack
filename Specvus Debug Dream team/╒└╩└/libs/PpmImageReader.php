<?php class PpmImageReader{public function PpmImageReader(){}public function getType(){return 'ppm';}public function canRead($d0){$n1=pathinfo($d0);$y2=strtolower($n1['extension']);return($y2=='ppm'||$y2=='pbm'||$y2=='pgm');}public function read($d0){$u3=$this->getType();$o4=array($u3,null,0,0,0,0);$t5=null;try{$t5=$this->readPnm($d0);}catch(Exception $t6){}if($t5){$y7=imagesx($t5);$j8=imagesy($t5);$o4=array($u3,$t5,$y7,$j8,0,0);}return $o4;}private function readPnm($d0){$o9='';$c10=0;$s11=0;$t5=null;$y12=1;$y13='';$w14=@fopen($d0,"rb");if($w14){$o9=fread($w14,2);if(!in_array($o9,array('P1','P2','P3','P4','P5','P6')))throw new Exception('No pnm file - "['.ord($y13[0]).']['.ord($y13[1]).']" is not a valid magic number.');$y13=$this->readLine($w14);$y13=$this->readLine($w14);while(preg_match('/^#/m',$y13)!==0){$y13=$this->readLine($w14);}$h15=($o9==1||$o9==4?2:3);$w16=array();do{$w16=array_merge($w16,preg_split("/[ \t]+/",$y13));$y13=$this->readLine($w14);}while(!feof($w14)&&count($w16)<$h15);fseek($w14,0-strlen($y13),SEEK_CUR);$c10=trim($w16[0]);$s11=trim($w16[1]);if(count($w16)>2)$y12=$w16[2];if($y12>255)throw new Exception("Unable to read ppm with max value > 255 ($y12)");$t5=imagecreatetruecolor($c10,$s11);if($o9=='P6'){for($s17=0;$s17<$s11&&!feof($w14);$s17++){for($l18=0;$l18<$c10;$l18++){$y19=@unpack('N',chr(0).fread($w14,3));if($y19){$y19=$y19[1];imagesetpixel($t5,$l18,$s17,$y19);}}}}else if($o9=='P5'){for($s17=0;$s17<$s11&&!feof($w14);$s17++){for($l18=0;$l18<$c10;$l18++){$x20=fread($w14,1);$y19=$x20<<16|$x20<<8|$x20;imagesetpixel($t5,$l18,$s17,$y19);}}}else if($o9=='P4'){$l18=0;$s17=0;while($s17<$s11){$x20=fread($w14,1);$r21=128;for($k22=0;$k22<8;$k22++){$o4=$x20&$r21;$o4=($o4>0?0:255);$y19=$o4<<16|$o4<<8|$o4;imagesetpixel($t5,$l18,$s17,$y19);$r21>>1;$l18++;if($l18>$c10){$l18=0;$s17++;}}}}else if($o9=='P3'){for($s17=0;$s17<$s11&&!feof($w14);$s17++){for($l18=0;$l18<$c10;$l18++){$o4=intval($this->readNextToken($w14));$m23=intval($this->readNextToken($w14));$x20=intval($this->readNextToken($w14));$y19=$o4<<16|$m23<<8|$x20;imagesetpixel($t5,$l18,$s17,$y19);}}}else if($o9=='P2'){for($s17=0;$s17<$s11&&!feof($w14);$s17++){for($l18=0;$l18<$c10;$l18++){$o4=intval($this->readNextToken($w14));$y19=$o4<<16|$o4<<8|$o4;imagesetpixel($t5,$l18,$s17,$y19);}}}else if($o9=='P1'){for($s17=0;$s17<$s11&&!feof($w14);$s17++){for($l18=0;$l18<$c10;$l18++){$x20=fread($w14,1);$o4=($x20>0?0:255);$y19=$o4<<16|$o4<<8|$o4;imagesetpixel($t5,$l18,$s17,$y19);}}}fclose($w14);}return $t5;}static function readLine($w14){$y13='';$x20='';while(($x20=fread($w14,1))!==''){$y13.=$x20;if(ord($x20)==10)break;}return $y13;}private function readToken($w14){$y13='';while(($x20=fread($w14,1))!==''){if(preg_match("[ \t\n\r]",$x20)===1)break;$y13.=$x20;}if(!feof($w14))fseek($w14,-1,SEEK_CUR);return $y13;}private function readWhite($w14){$y13='';while(($x20=fread($w14,1))!==''){if(preg_match("[ \t\n\r]",$x20)===0)break;$y13.=$x20;}if(!feof($w14))fseek($w14,-1,SEEK_CUR);return $y13;}private function readNextToken($w14){$j24=$this->readWhite($w14);return $this->readToken($w14);}}?>